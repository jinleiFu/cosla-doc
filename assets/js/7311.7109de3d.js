"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[7311],{7311:(e,i,t)=>{t.r(i),t.d(i,{default:()=>p});var l=t(6252);const s={class:"clearfix qiniu-upload"},r={key:0},a=(0,l._)("div",{class:"ant-upload-text"},"上传照片",-1),n=["src"];var o=t(2922),u=t(2262);const d=(0,l.aZ)({components:{PlusOutlined:o.Z},props:{keys:{type:Array,default:()=>[]},errorKeys:{type:Array,default:()=>[]},show:Boolean,limit:{type:Number,default:1/0}},setup(e,{emit:i}){const t=(0,u.iH)(!1),s=(0,u.iH)(""),r=(0,u.iH)(e.show),a=(0,u.iH)(""),n=(0,u.qj)({fileList:[],urlLoaded:!1});(0,l.bv)((()=>{}));const o=(0,u.Fl)((()=>[...e.keys,...e.errorKeys]));function d(e){return["http","https"].some((i=>0===e.indexOf(i)))}return(0,l.YP)(o,(i=>{!async function(i){if(!i.length||n.urlLoaded)return;const t=[],l=i.filter((e=>d(e))),s=i.filter((e=>!d(e)));if(l.forEach(((i,l)=>{const s=e.errorKeys.includes(i)?"error":"done";t.push({url:i,status:s,fileKey:i,uid:`${l}${i}`})})),s.length){const{data:i}=await qiniuFileUrlList({fileKeys:s});Object.keys(i).forEach(((l,s)=>{const r=e.errorKeys.includes(l)?"error":"done",a=i[l];t.push({fileKey:l,url:a,status:r,uid:`${s}${l}`})}))}n.fileList=t,n.urlLoaded=!0}(i)}),{immediate:!0}),{previewShow:t,imgUrl:s,displayUpload:r,token:a,...(0,u.BK)(n),previewHide:()=>{t.value=!1},previewImage:async e=>{e.url||e.preview||(e.preview=await function(e){return new Promise(((i,t)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=()=>i(l.result),l.onerror=e=>t(e)}))}(e.originFileObj)),s.value=e.url||e.preview,t.value=!0},changeFiles:t=>{const{file:l}=t;let s=[...t.fileList];if("removed"===l.status){const{uid:e}=l,i=n.fileList.findIndex((i=>i.uid===e));n.fileList.splice(i,1)}else e.limit!==1/0?n.fileList=s.slice(-e.limit):n.fileList=s;if(s.every((e=>"uploading"!==e.status))){const e=[];s.forEach((i=>{i.fileKey?e.push(i.fileKey):i.response&&e.push(i.response.key)})),i("revise",{keys:e,fileList:s})}},clearFiles:()=>{n.fileList=[]}}}}),p=(0,t(3744).Z)(d,[["render",function(e,i,t,o,u,d){const p=(0,l.up)("plus-outlined"),c=(0,l.up)("a-upload"),f=(0,l.up)("a-modal");return(0,l.wg)(),(0,l.iD)("div",s,[(0,l.Wm)(c,{"file-list":e.fileList,disabled:!e.displayUpload,action:"https://upload-cn-east-2.qiniup.com",data:{token:e.token},accept:"image/jpeg,image/jpg,image/png","list-type":"picture-card",multiple:"",onPreview:e.previewImage,onChange:e.changeFiles},{default:(0,l.w5)((()=>[e.displayUpload&&e.fileList.length<e.limit?((0,l.wg)(),(0,l.iD)("div",r,[(0,l.WI)(e.$slots,"default",{},(()=>[(0,l.Wm)(p),a]))])):(0,l.kq)("",!0)])),_:3},8,["file-list","disabled","data","onPreview","onChange"]),(0,l.Wm)(f,{centered:"",visible:e.previewShow,footer:null,onCancel:e.previewHide},{default:(0,l.w5)((()=>[(0,l._)("img",{style:{width:"100%"},src:e.imgUrl},null,8,n)])),_:1},8,["visible","onCancel"])])}]])}}]);